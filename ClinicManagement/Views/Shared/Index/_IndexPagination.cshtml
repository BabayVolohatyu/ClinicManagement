@model dynamic
@{
    var sortAscending = Model.SortAscending;
    var currentSortBy = Model.SortBy ?? "Id";
}

<div class="d-flex justify-content-between align-items-center mt-3">
    <small class="text-muted">
        Showing @((Model.PageNumber - 1) * Model.PageSize + 1) to
        @Math.Min(Model.PageNumber * Model.PageSize, Model.TotalCount)
        of @Model.TotalCount entries
    </small>

    <nav>
        <ul class="pagination mb-0">
            <li class="page-item @(!Model.HasPrevious ? "disabled" : "")">
                <a class="page-link"
                   href="@Url.Action("Index", new {
                       pageNumber = Model.PageNumber - 1,
                       pageSize = Model.PageSize,
                       searchTerm = Model.SearchTerm,
                       sortBy = currentSortBy,
                       sortAscending = sortAscending
                   })">
                    &laquo;
                </a>
            </li>

            @{
                int currentPage = Model.PageNumber;
                int totalPages = Model.TotalPages;
                int maxVisiblePages = 7;
                
                if (totalPages <= maxVisiblePages)
                {
                    // Show all pages if total is small
                    for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(i == currentPage ? "active" : "")">
                            <a class="page-link"
                               href="@Url.Action("Index", new {
                                   pageNumber = i,
                                   pageSize = Model.PageSize,
                                   searchTerm = Model.SearchTerm,
                                   sortBy = currentSortBy,
                                   sortAscending = sortAscending
                               })">
                                @i
                            </a>
                        </li>
                    }
                }
                else
                {
                    // Smart pagination with ellipsis
                    int startPage, endPage;
                    bool showLeftEllipsis = false;
                    bool showRightEllipsis = false;
                    
                    if (currentPage <= 4)
                    {
                        // Near the start: show 1, 2, 3, 4, 5, ..., last
                        startPage = 1;
                        endPage = 5;
                        showRightEllipsis = true;
                    }
                    else if (currentPage >= totalPages - 3)
                    {
                        // Near the end: show 1, ..., last-4, last-3, last-2, last-1, last
                        startPage = totalPages - 4;
                        endPage = totalPages;
                        showLeftEllipsis = true;
                    }
                    else
                    {
                        // In the middle: show 1, ..., current-2, current-1, current, current+1, current+2, ..., last
                        startPage = currentPage - 2;
                        endPage = currentPage + 2;
                        showLeftEllipsis = true;
                        showRightEllipsis = true;
                    }
                    
                    // Always show first page
                    <li class="page-item @(1 == currentPage ? "active" : "")">
                        <a class="page-link"
                           href="@Url.Action("Index", new {
                               pageNumber = 1,
                               pageSize = Model.PageSize,
                               searchTerm = Model.SearchTerm,
                               sortBy = currentSortBy,
                               sortAscending = sortAscending
                           })">
                            1
                        </a>
                    </li>
                    
                    // Left ellipsis
                    if (showLeftEllipsis)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                    
                    // Middle pages (skip 1 and last as they're shown separately)
                    for (int i = startPage; i <= endPage; i++)
                    {
                        if (i > 1 && i < totalPages)
                        {
                            <li class="page-item @(i == currentPage ? "active" : "")">
                                <a class="page-link"
                                   href="@Url.Action("Index", new {
                                       pageNumber = i,
                                       pageSize = Model.PageSize,
                                       searchTerm = Model.SearchTerm,
                                       sortBy = currentSortBy,
                                       sortAscending = sortAscending
                                   })">
                                    @i
                                </a>
                            </li>
                        }
                    }
                    
                    // Right ellipsis
                    if (showRightEllipsis)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                    
                    // Always show last page
                    <li class="page-item @(totalPages == currentPage ? "active" : "")">
                        <a class="page-link"
                           href="@Url.Action("Index", new {
                               pageNumber = totalPages,
                               pageSize = Model.PageSize,
                               searchTerm = Model.SearchTerm,
                               sortBy = currentSortBy,
                               sortAscending = sortAscending
                           })">
                            @totalPages
                        </a>
                    </li>
                }
            }

            <li class="page-item @(!Model.HasNext ? "disabled" : "")">
                <a class="page-link"
                   href="@Url.Action("Index", new {
                       pageNumber = Model.PageNumber + 1,
                       pageSize = Model.PageSize,
                       searchTerm = Model.SearchTerm,
                       sortBy = currentSortBy,
                       sortAscending = sortAscending
                   })">
                    &raquo;
                </a>
            </li>
        </ul>
    </nav>
</div>

