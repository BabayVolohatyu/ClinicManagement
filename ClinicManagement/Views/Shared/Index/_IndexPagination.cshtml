@model dynamic
@{
    var sortAscending = Model.SortAscending;
    var currentSortBy = Model.SortBy ?? "Id";
    var statusFilter = ViewData["StatusFilter"]?.ToString();
}

<div class="d-flex justify-content-between align-items-center mt-3">
    <small class="text-muted">
        Showing @((Model.PageNumber - 1) * Model.PageSize + 1) to
        @Math.Min(Model.PageNumber * Model.PageSize, Model.TotalCount)
        of @Model.TotalCount entries
    </small>

    <nav>
        <ul class="pagination mb-0">
            <li class="page-item @(!Model.HasPrevious ? "disabled" : "")">
                @{
                    var prevRouteValues = new Dictionary<string, object?>
                    {
                        { "pageNumber", Model.PageNumber - 1 },
                        { "pageSize", Model.PageSize },
                        { "searchTerm", Model.SearchTerm },
                        { "sortBy", currentSortBy },
                        { "sortAscending", sortAscending }
                    };
                    if (!string.IsNullOrEmpty(statusFilter))
                    {
                        prevRouteValues["status"] = statusFilter;
                    }
                }
                <a class="page-link"
                   href="@Url.Action("Index", prevRouteValues)">
                    &laquo;
                </a>
            </li>

            @{
                int currentPage = Model.PageNumber;
                int totalPages = Model.TotalPages;
                int maxVisiblePages = 7;
                
                if (totalPages <= maxVisiblePages)
                {
                    
                    for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(i == currentPage ? "active" : "")">
                            @{
                                var pageRouteValues = new Dictionary<string, object?>
                                {
                                    { "pageNumber", i },
                                    { "pageSize", Model.PageSize },
                                    { "searchTerm", Model.SearchTerm },
                                    { "sortBy", currentSortBy },
                                    { "sortAscending", sortAscending }
                                };
                                if (!string.IsNullOrEmpty(statusFilter))
                                {
                                    pageRouteValues["status"] = statusFilter;
                                }
                            }
                            <a class="page-link"
                               href="@Url.Action("Index", pageRouteValues)">
                                @i
                            </a>
                        </li>
                    }
                }
                else
                {
                    int startPage, endPage;
                    bool showLeftEllipsis = false;
                    bool showRightEllipsis = false;
                    
                    if (currentPage <= 4)
                    {
                        startPage = 1;
                        endPage = 5;
                        showRightEllipsis = true;
                    }
                    else if (currentPage >= totalPages - 3)
                    {
                        startPage = totalPages - 4;
                        endPage = totalPages;
                        showLeftEllipsis = true;
                    }
                    else
                    {
                        startPage = currentPage - 2;
                        endPage = currentPage + 2;
                        showLeftEllipsis = true;
                        showRightEllipsis = true;
                    }
                    
                    <li class="page-item @(1 == currentPage ? "active" : "")">
                        @{
                            var firstRouteValues = new Dictionary<string, object?>
                            {
                                { "pageNumber", 1 },
                                { "pageSize", Model.PageSize },
                                { "searchTerm", Model.SearchTerm },
                                { "sortBy", currentSortBy },
                                { "sortAscending", sortAscending }
                            };
                            if (!string.IsNullOrEmpty(statusFilter))
                            {
                                firstRouteValues["status"] = statusFilter;
                            }
                        }
                        <a class="page-link"
                           href="@Url.Action("Index", firstRouteValues)">
                            1
                        </a>
                    </li>
                    
                    if (showLeftEllipsis)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                    
                    for (int i = startPage; i <= endPage; i++)
                    {
                        if (i > 1 && i < totalPages)
                        {
                            <li class="page-item @(i == currentPage ? "active" : "")">
                                <a class="page-link"
                                   href="@Url.Action("Index", new {
                                       pageNumber = i,
                                       pageSize = Model.PageSize,
                                       searchTerm = Model.SearchTerm,
                                       sortBy = currentSortBy,
                                       sortAscending = sortAscending
                                   })">
                                    @i
                                </a>
                            </li>
                        }
                    }
                    
                    if (showRightEllipsis)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                    
                    <li class="page-item @(totalPages == currentPage ? "active" : "")">
                        @{
                            var lastRouteValues = new Dictionary<string, object?>
                            {
                                { "pageNumber", totalPages },
                                { "pageSize", Model.PageSize },
                                { "searchTerm", Model.SearchTerm },
                                { "sortBy", currentSortBy },
                                { "sortAscending", sortAscending }
                            };
                            if (!string.IsNullOrEmpty(statusFilter))
                            {
                                lastRouteValues["status"] = statusFilter;
                            }
                        }
                        <a class="page-link"
                           href="@Url.Action("Index", lastRouteValues)">
                            @totalPages
                        </a>
                    </li>
                }
            }

            <li class="page-item @(!Model.HasNext ? "disabled" : "")">
                @{
                    var nextRouteValues = new Dictionary<string, object?>
                    {
                        { "pageNumber", Model.PageNumber + 1 },
                        { "pageSize", Model.PageSize },
                        { "searchTerm", Model.SearchTerm },
                        { "sortBy", currentSortBy },
                        { "sortAscending", sortAscending }
                    };
                    if (!string.IsNullOrEmpty(statusFilter))
                    {
                        nextRouteValues["status"] = statusFilter;
                    }
                }
                <a class="page-link"
                   href="@Url.Action("Index", nextRouteValues)">
                    &raquo;
                </a>
            </li>
        </ul>
    </nav>
</div>

