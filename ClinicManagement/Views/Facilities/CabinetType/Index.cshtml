@model ClinicManagement.Services.PaginatedResult<ClinicManagement.Models.Facilities.CabinetType>

@{
    ViewData["Title"] = "Cabinet Types";
    ViewData["Entity"] = ViewContext.RouteData.Values["controller"]?.ToString().ToLower();
    var sortAscending = Model.SortAscending;
    var currentSortBy = Model.SortBy ?? "Id";
}

<div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">
        <h2 class="mb-4">Cabinet Types</h2>

        <!-- Search and Filter Section -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    
                    <form method="get" class="d-flex gap-2 align-items-center">
                        <input type="hidden" name="pageNumber" value="1" />
                        <input type="hidden" name="sortBy" value="@currentSortBy" />
                        <input type="hidden" name="sortAscending" value="@sortAscending.ToString().ToLower()" />
                        
                        <div class="input-group">
                            <input type="text" 
                                   class="form-control" 
                                   placeholder="Search cabinet types..." 
                                   name="searchTerm" 
                                   value="@Model.SearchTerm" />
                            <button type="submit" class="btn btn-primary">Search</button>
                            @if (!string.IsNullOrEmpty(Model.SearchTerm))
                            {
                                <a href="@Url.Action("Index", new { pageNumber = 1, pageSize = Model.PageSize })" 
                                   class="btn btn-outline-secondary">Clear</a>
                            }
                        </div>
                        
                        <select class="form-select" name="pageSize" onchange="this.form.submit()" style="width: auto;">
                            <option value="5" selected="@(Model.PageSize == 5)">5 per page</option>
                            <option value="10" selected="@(Model.PageSize == 10)">10 per page</option>
                            <option value="25" selected="@(Model.PageSize == 25)">25 per page</option>
                            <option value="50" selected="@(Model.PageSize == 50)">50 per page</option>
                        </select>
                    </form>
                </div>
            </div>
        </div>

        @if (!Model.Items.Any())
        {
            <div class="alert alert-info text-center">
                @(string.IsNullOrEmpty(Model.SearchTerm) ? "No cabinet types found." : "No cabinet types match your search criteria.")
            </div>
        }
        else
        {
            <div class="card">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>
                                        <a href="@Url.Action("Index", new { 
                                            pageNumber = 1, 
                                            pageSize = Model.PageSize,
                                            searchTerm = Model.SearchTerm,
                                            sortBy = "Id",
                                            sortAscending = currentSortBy == "Id" ? !sortAscending : true
                                        })" class="text-decoration-none">
                                            ID
                                            @if (currentSortBy == "Id")
                                            {
                                                <span>@(sortAscending ? "↑" : "↓")</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">↕</span>
                                            }
                                        </a>
                                    </th>
                                    <th>
                                        <a href="@Url.Action("Index", new { 
                                            pageNumber = 1, 
                                            pageSize = Model.PageSize,
                                            searchTerm = Model.SearchTerm,
                                            sortBy = "Type",
                                            sortAscending = currentSortBy == "Type" ? !sortAscending : true
                                        })" class="text-decoration-none">
                                            Type
                                            @if (currentSortBy == "Type")
                                            {
                                                <span>@(sortAscending ? "↑" : "↓")</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">↕</span>
                                            }
                                        </a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.Items)
                                {
                                    <tr class="clickable-row" data-href="@Url.Action("Entity", new { id = item.Id })">
                                        <td>@item.Id</td>
                                        <td>@item.Type</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div class="d-flex justify-content-between align-items-center mt-3">
                <small class="text-muted">
                    Showing @((Model.PageNumber - 1) * Model.PageSize + 1) to 
                    @Math.Min(Model.PageNumber * Model.PageSize, Model.TotalCount) of 
                    @Model.TotalCount entries
                    @if (!string.IsNullOrEmpty(Model.SearchTerm))
                    {
                        <span>(filtered)</span>
                    }
                </small>

                <nav aria-label="Page navigation">
                    <ul class="pagination mb-0">
                        <li class="page-item @(!Model.HasPrevious ? "disabled" : "")">
                            <a class="page-link" 
                               href="@Url.Action("Index", new { 
                                   pageNumber = Model.PageNumber - 1, 
                                   pageSize = Model.PageSize,
                                   searchTerm = Model.SearchTerm,
                                   sortBy = currentSortBy,
                                   sortAscending = sortAscending
                               })" 
                               aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>

                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                                <a class="page-link" 
                                   href="@Url.Action("Index", new { 
                                       pageNumber = i, 
                                       pageSize = Model.PageSize,
                                       searchTerm = Model.SearchTerm,
                                       sortBy = currentSortBy,
                                       sortAscending = sortAscending
                                   })">
                                    @i
                                </a>
                            </li>
                        }

                        <li class="page-item @(!Model.HasNext ? "disabled" : "")">
                            <a class="page-link" 
                               href="@Url.Action("Index", new { 
                                   pageNumber = Model.PageNumber + 1, 
                                   pageSize = Model.PageSize,
                                   searchTerm = Model.SearchTerm,
                                   sortBy = currentSortBy,
                                   sortAscending = sortAscending
                               })" 
                               aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function changePageSize(pageSize) {
            const url = new URL(window.location.href);
            url.searchParams.set('pageSize', pageSize);
            url.searchParams.set('pageNumber', '1');
            window.location.href = url.toString();
        }

        document.addEventListener("DOMContentLoaded", function () {
            const rows = document.querySelectorAll(".clickable-row");
            rows.forEach(row => {
                row.addEventListener("click", () => {
                    const href = row.getAttribute("data-href");
                    if(href) window.location.href = href;
                });
            });
        });
    </script>
}